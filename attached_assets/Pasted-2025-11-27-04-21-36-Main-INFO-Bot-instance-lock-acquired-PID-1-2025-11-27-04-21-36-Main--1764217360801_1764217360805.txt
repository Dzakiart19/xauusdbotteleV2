2025-11-27 04:21:36 - Main - INFO - Bot instance lock acquired (PID: 1)
2025-11-27 04:21:36 - Main - INFO - Sentry error tracking initialized (environment: production)
2025-11-27 04:21:36 - Main - INFO - Validating configuration...
2025-11-27 04:21:36 - Main - INFO - ‚úÖ Configuration validated successfully
2025-11-27 04:21:36 - Main - INFO - Database initialized
2025-11-27 04:21:36 - Main - INFO - Database backup manager initialized
2025-11-27 04:21:36 - TaskScheduler - INFO - Task scheduler initialized with alert system (cleanup interval: 300s)
2025-11-27 04:21:36 - Main - INFO - Task scheduler initialized (available in all modes)
2025-11-27 04:21:36 - Main - INFO - Initializing Trading Bot components...
2025-11-27 04:21:36 - Main - INFO - Error handler initialized
2025-11-27 04:21:36 - UserManager - INFO - User manager initialized with thread-safe RLock per-user locking
2025-11-27 04:21:36 - Main - INFO - User manager initialized
2025-11-27 04:21:36 - MarketData - INFO - MarketDataClient diinisialisasi dengan penanganan error yang ditingkatkan
2025-11-27 04:21:36 - MarketData - INFO - WebSocket URL: wss://ws.derivws.com/websockets/v3?app_id=1089, Symbol: frxXAUUSD
2025-11-27 04:21:36 - MarketData - INFO - Mekanisme Pub/Sub diinisialisasi dengan manajemen lifecycle
2025-11-27 04:21:36 - MarketData - INFO - ‚úÖ Circuit breaker diinisialisasi untuk koneksi WebSocket (threshold=3, timeout=45s)
2025-11-27 04:21:36 - MarketData - INFO - ‚úÖ State machine koneksi diinisialisasi
2025-11-27 04:21:36 - MarketData - INFO - ‚úÖ Mekanisme candle close event diinisialisasi
2025-11-27 04:21:36 - Main - INFO - Market data client initialized
2025-11-27 04:21:36 - Main - INFO - Trading strategy initialized
2025-11-27 04:21:36 - Main - INFO - Risk manager initialized
2025-11-27 04:21:36 - ChartGenerator - INFO - ChartGenerator diinisialisasi: max_workers=1, chart_timeout=60.0s, shutdown_timeout=30.0s (FREE_TIER_MODE=True)
2025-11-27 04:21:36 - Main - INFO - Chart generator initialized
2025-11-27 04:21:36 - AlertSystem - INFO - Alert system initialized (max_queue=100, max_history=100)
2025-11-27 04:21:36 - Main - INFO - Alert system initialized
2025-11-27 04:21:36 - SignalSessionManager - INFO - Signal Session Manager diinisialisasi dengan proteksi spam sinyal
2025-11-27 04:21:36 - Main - INFO - Signal session manager initialized
2025-11-27 04:21:36 - Main - INFO - Position tracker initialized
2025-11-27 04:21:36 - TelegramBot - INFO - ‚úÖ Rate limiter global diinisialisasi untuk Telegram API
2025-11-27 04:21:36 - TelegramBot - INFO - ‚úÖ Per-user rate limiter diinisialisasi: max 10 calls/60.0s per user
2025-11-27 04:21:36 - TelegramBot - INFO - ‚úÖ UNLIMITED signal detection: global_cooldown=0.0s, tick_throttle=0.0s
2025-11-27 04:21:36 - TelegramBot - INFO - ‚úÖ Anti-duplicate cache: expiry=300s, dengan tracking per signal type
2025-11-27 04:21:36 - TelegramBot - INFO - ‚úÖ Two-phase anti-duplicate signal cache initialized (pending‚Üíconfirmed) with telemetry
2025-11-27 04:21:36 - Main - INFO - Telegram bot initialized
2025-11-27 04:21:36 - Main - INFO - All components initialized successfully
2025-11-27 04:21:36 - Main - INFO - ============================================================
2025-11-27 04:21:36 - Main - INFO - XAUUSD TRADING BOT STARTING
2025-11-27 04:21:36 - Main - INFO - ============================================================
2025-11-27 04:21:36 - Main - INFO - Mode: LIVE
2025-11-27 04:21:36 - Main - INFO - Config Valid: YES ‚úÖ
2025-11-27 04:21:36 - Main - INFO - Telegram Bot Token: Configured (8083...4Ooc)
2025-11-27 04:21:36 - Main - WARNING - ‚ö†Ô∏è Bot token detected - ensure it's never logged in plain text
2025-11-27 04:21:36 - Main - INFO - Authorized Users: 1
2025-11-27 04:21:36 - Main - INFO - LOT_SIZE: 0.01 | XAUUSD_PIP_VALUE: 10.0
2025-11-27 04:21:36 - Main - INFO - DYNAMIC_SL_THRESHOLD: $1.0 | FIXED_RISK: $1.0
2025-11-27 04:21:36 - Main - INFO - ============================================================
2025-11-27 04:21:36 - Main - INFO - Starting health check server...
2025-11-27 04:21:36 - Main - INFO - ‚úÖ Port 5000 is available
2025-11-27 04:21:36 - Main - INFO - Webhook route registered: /bot8083284621:AAGANGmpHZ2op0zbXt-uUb-t9dyUBYi4Ooc
2025-11-27 04:21:36 - Main - INFO - Health check server started on port 5000
2025-11-27 04:21:36 - Main - INFO - Loading candles from database...
2025-11-27 04:21:36 - MarketData - INFO - Cleared existing candle builders before loading from database
2025-11-27 04:21:36 - MarketData - INFO - ‚úÖ Loaded candles from database: M1=100, M5=100
2025-11-27 04:21:36 - MarketData - INFO - Bot has candles immediately - no waiting for Deriv API!
2025-11-27 04:21:36 - MarketData - INFO - ‚úÖ Set _loaded_from_db=True - will skip historical fetch from Deriv
2025-11-27 04:21:36 - Main - INFO - Connecting to market data feed...
2025-11-27 04:21:36 - Main - INFO - Waiting for initial market data (max 10s)...
2025-11-27 04:21:36 - MarketData - INFO - üîÑ Connection state: DISCONNECTED ‚Üí CONNECTING
2025-11-27 04:21:36 - MarketData - INFO - Connecting to Deriv WebSocket (attempt 1): wss://ws.derivws.com/websockets/v3?app_id=1089
Instance is starting... Waiting for health checks to pass.
2025-11-27 04:21:37 - Main - INFO - Connecting to market data... (0s)
2025-11-27 04:21:38 - MarketData - INFO - üîÑ Connection state: CONNECTING ‚Üí CONNECTED
2025-11-27 04:21:38 - MarketData - INFO - ‚úÖ Connected to Deriv WebSocket successfully
2025-11-27 04:21:38 - MarketData - INFO - ‚úÖ Skipping historical fetch - already loaded from DB
2025-11-27 04:21:38 - MarketData - INFO - Current candle counts: M1=100, M5=100
2025-11-27 04:21:38 - MarketData - INFO - Final candle counts after init: M1=100, M5=100
2025-11-27 04:21:38 - MarketData - INFO - üì° Subscribed to frxXAUUSD
2025-11-27 04:21:38 - MarketData - INFO - üîÑ Starting periodic subscriber cleanup (interval=60s, stale_timeout=300s, zombie_timeout=120s)
2025-11-27 04:21:38 - Main - INFO - ‚úÖ Market data connection established
2025-11-27 04:21:38 - Main - INFO - Setting up scheduled tasks...
2025-11-27 04:21:38 - TaskScheduler - INFO - Setting up default scheduled tasks
2025-11-27 04:21:38 - TaskScheduler - INFO - Task added: cleanup_charts (interval=1800s, schedule=None)
2025-11-27 04:21:38 - TaskScheduler - INFO - Task added: aggressive_chart_cleanup (interval=300s, schedule=None)
2025-11-27 04:21:38 - TaskScheduler - INFO - Task added: daily_summary (interval=Nones, schedule=23:55:00)
2025-11-27 04:21:38 - TaskScheduler - INFO - Task added: database_cleanup (interval=Nones, schedule=03:00:00)
2025-11-27 04:21:38 - TaskScheduler - INFO - Task added: health_check (interval=300s, schedule=None)
2025-11-27 04:21:38 - TaskScheduler - INFO - Task added: position_monitoring (interval=10s, schedule=None)
2025-11-27 04:21:38 - TaskScheduler - INFO - Task added: periodic_gc (interval=300s, schedule=None)
2025-11-27 04:21:38 - TaskScheduler - INFO - Task added: save_candles (interval=60s, schedule=None)
2025-11-27 04:21:38 - TaskScheduler - INFO - Configured 8 default scheduled tasks
2025-11-27 04:21:38 - Main - INFO - Scheduled tasks configured
2025-11-27 04:21:38 - Main - INFO - Starting task scheduler...
2025-11-27 04:21:38 - TaskScheduler - INFO - Task scheduler dimulai dengan cleanup loop
2025-11-27 04:21:38 - Main - INFO - Starting position tracker...
2025-11-27 04:21:38 - Main - INFO - Reloading active positions from database...
2025-11-27 04:21:38 - PositionTracker - INFO - Reloaded 1 active positions from database
2025-11-27 04:21:38 - Main - INFO - Initializing Telegram bot...
2025-11-27 04:21:38 - TelegramBot - INFO - Registered dashboard cleanup handler for session end events
2025-11-27 04:21:38 - TelegramBot - INFO - ‚úÖ Chart cleanup integrated with SignalSessionManager
2025-11-27 04:21:38 - TelegramBot - INFO - Registered chart eviction callback for ChartGenerator integration
2025-11-27 04:21:38 - TelegramBot - INFO - Initializing Telegram bot...
2025-11-27 04:21:38 - TaskScheduler - INFO - Scheduler loop dimulai
2025-11-27 04:21:38 - TaskScheduler - INFO - Cleanup loop dimulai (interval: 300s)
2025-11-27 04:21:38 - MarketData - INFO - ‚úÖ Subscriber 'position_tracker' registered with health metrics tracking
2025-11-27 04:21:38 - PositionTracker - INFO - Position tracker monitoring started
2025-11-27 04:21:38 - TaskScheduler - INFO - Executing scheduled task: cleanup_charts
2025-11-27 04:21:38 - TaskScheduler - INFO - Executing scheduled task: aggressive_chart_cleanup
2025-11-27 04:21:38 - TaskScheduler - INFO - Executing scheduled task: health_check
2025-11-27 04:21:38 - TaskScheduler - INFO - Executing scheduled task: position_monitoring
2025-11-27 04:21:38 - TaskScheduler - INFO - Executing scheduled task: periodic_gc
2025-11-27 04:21:38 - TaskScheduler - INFO - Executing scheduled task: save_candles
2025-11-27 04:21:38 - TaskScheduler - INFO - Running health check...
2025-11-27 04:21:38 - TaskScheduler - WARNING - Health check: No price data available
2025-11-27 04:21:39 - MarketData - INFO - ‚úÖ Saved candles to database: M1=100, M5=100
2025-11-27 04:21:39 - TaskScheduler - INFO - Task completed: cleanup_charts (Total runs: 1, Execution time: 121.65ms)
2025-11-27 04:21:39 - TaskScheduler - INFO - Task completed: aggressive_chart_cleanup (Total runs: 1, Execution time: 121.99ms)
2025-11-27 04:21:39 - TaskScheduler - INFO - Task completed: health_check (Total runs: 1, Execution time: 121.98ms)
2025-11-27 04:21:39 - TaskScheduler - INFO - Task completed: periodic_gc (Total runs: 1, Execution time: 121.63ms)
2025-11-27 04:21:39 - TaskScheduler - INFO - Task completed: save_candles (Total runs: 1, Execution time: 121.62ms)
2025-11-27 04:21:39 - PositionTracker - WARNING - No current price available for position monitoring
2025-11-27 04:21:39 - TaskScheduler - INFO - Task completed: position_monitoring (Total runs: 1, Execution time: 123.63ms)
2025-11-27 04:21:39 - TelegramBot - INFO - Telegram bot initialized and ready!
2025-11-27 04:21:39 - AlertSystem - INFO - Telegram app set with 1 chat IDs
2025-11-27 04:21:39 - Main - INFO - Telegram app set for alert system and position tracker with rate-limited callback
2025-11-27 04:21:39 - Main - INFO - Starting background cleanup tasks...
2025-11-27 04:21:39 - TelegramBot - INFO - ‚úÖ Signal cache cleanup background task started
2025-11-27 04:21:39 - TelegramBot - INFO - ‚úÖ Dashboard cleanup background task started
2025-11-27 04:21:39 - TelegramBot - INFO - ‚úÖ Pending chart cleanup background task started
2025-11-27 04:21:39 - Main - INFO - Starting Telegram bot polling...
2025-11-27 04:21:39 - Main - INFO - Waiting for candles to build (minimal 30 candles, max 20s)...
2025-11-27 04:21:39 - TelegramBot - WARNING - ‚ö†Ô∏è Stale lock file detected (PID 1871 not running)
2025-11-27 04:21:39 - TelegramBot - INFO - Removing stale lock file: data/.bot_instance.lock
2025-11-27 04:21:39 - TelegramBot - INFO - ‚úÖ Stale lock file removed successfully
2025-11-27 04:21:39 - TelegramBot - INFO - ‚úÖ Bot instance lock created: PID 1
2025-11-27 04:21:39 - TelegramBot - INFO - Starting Telegram bot polling...
2025-11-27 04:21:39 - TelegramBot - INFO - Telegram bot is running!
2025-11-27 04:21:40 - Main - INFO - ‚úÖ Got 100 candles, ready for trading!
2025-11-27 04:21:40 - Main - INFO - Auto-starting monitoring for 1 valid users...
2025-11-27 04:21:40 - TelegramBot - INFO - Auto-starting monitoring for chat 739***903
2025-11-27 04:21:40 - TelegramBot - INFO - ‚úÖ Monitoring task created for chat 739***903
2025-11-27 04:21:40 - Main - INFO - ============================================================
2025-11-27 04:21:40 - Main - INFO - BOT IS NOW RUNNING
2025-11-27 04:21:40 - Main - INFO - Registered tasks: ['market_data_websocket', 'position_tracker', 'telegram_bot']
2025-11-27 04:21:40 - Main - INFO - ============================================================
2025-11-27 04:21:40 - Main - INFO - Press Ctrl+C to stop
2025-11-27 04:21:40 - MarketData - INFO - ‚úÖ Subscriber 'telegram_bot_7390867903' registered with health metrics tracking
Instance is healthy. All health checks are passing.
Error while getting Updates: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
Exception happened while polling for updates.
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_updater.py", line 688, in _network_loop_retry
    if not await action_cb():
           ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_updater.py", line 384, in polling_action_cb
    raise exc
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_updater.py", line 373, in polling_action_cb
    updates = await self.bot.get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_extbot.py", line 558, in get_updates
    updates = await super().get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 525, in decorator
    result = await func(self, *args, **kwargs)  # skipcq: PYL-E1102
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 3584, in get_updates
    await self._post(
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 613, in _post
    return await self._do_post(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_extbot.py", line 340, in _do_post
    return await super()._do_post(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 641, in _do_post
    return await request.post(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/request/_baserequest.py", line 200, in post
    result = await self._request_wrapper(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/request/_baserequest.py", line 381, in _request_wrapper
    raise Conflict(message)
telegram.error.Conflict: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
Error while getting Updates: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
Exception happened while polling for updates.
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_updater.py", line 688, in _network_loop_retry
    if not await action_cb():
           ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_updater.py", line 384, in polling_action_cb
    raise exc
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_updater.py", line 373, in polling_action_cb
    updates = await self.bot.get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_extbot.py", line 558, in get_updates
    updates = await super().get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 525, in decorator
    result = await func(self, *args, **kwargs)  # skipcq: PYL-E1102
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 3584, in get_updates
    await self._post(
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 613, in _post
    return await self._do_post(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_extbot.py", line 340, in _do_post
    return await super()._do_post(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 641, in _do_post
    return await request.post(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/request/_baserequest.py", line 200, in post
    result = await self._request_wrapper(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/request/_baserequest.py", line 381, in _request_wrapper
    raise Conflict(message)
telegram.error.Conflict: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-11-27 04:21:49 - TaskScheduler - INFO - Executing scheduled task: position_monitoring
2025-11-27 04:21:49 - PositionTracker - WARNING - No current price available for position monitoring
2025-11-27 04:21:49 - TaskScheduler - INFO - Task completed: position_monitoring (Total runs: 2, Execution time: 1.02ms)
2025-11-27 04:21:53 - MarketData - ERROR - API Error (code WrongResponse): Sorry, an error occurred while processing your request.
Error while getting Updates: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
Exception happened while polling for updates.
Traceback (most recent call last):
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_updater.py", line 688, in _network_loop_retry
    if not await action_cb():
           ^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_updater.py", line 384, in polling_action_cb
    raise exc
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_updater.py", line 373, in polling_action_cb
    updates = await self.bot.get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_extbot.py", line 558, in get_updates
    updates = await super().get_updates(
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 525, in decorator
    result = await func(self, *args, **kwargs)  # skipcq: PYL-E1102
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 3584, in get_updates
    await self._post(
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 613, in _post
    return await self._do_post(
           ^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/ext/_extbot.py", line 340, in _do_post
    return await super()._do_post(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/_bot.py", line 641, in _do_post
    return await request.post(
           ^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/request/_baserequest.py", line 200, in post
    result = await self._request_wrapper(
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/local/lib/python3.11/site-packages/telegram/request/_baserequest.py", line 381, in _request_wrapper
    raise Conflict(message)
telegram.error.Conflict: Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-11-27 04:21:59 - TaskScheduler - INFO - Executing scheduled task: position_monitoring
2025-11-27 04:21:59 - PositionTracker - WARNING - No current price available for position monitoring
2025-11-27 04:21:59 - TaskScheduler - INFO - Task completed: position_monitoring (Total runs: 3, Execution time: 0.83ms)